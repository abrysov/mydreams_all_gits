#!/bin/bash
#
# Generated by Ansible
# Local modifications will be overwritten.
#

# Settings
APP_ROOT={{ dreams_web_base_dir }}
APP_USER={{ dreams_deploy_user.name }}
APP_GROUP={{ dreams_deploy_user.name }}
APP_RAILS_ENV='{{ dreams_env }}'

CMD="bundle exec sidekiq -c {{ item.concurency }} -q {{ item.queue }} -e ${APP_RAILS_ENV}"

# Set ENV
export PATH=/home/{{ dreams_deploy_user.name }}/.rbenv/shims:/home/{{ dreams_deploy_user.name }}/.rbenv/bin:$PATH
export RAILS_ENV=$APP_RAILS_ENV

cd $APP_ROOT/current

# Run
exec 2>&1
echo "Running sidekiq..."
exec chpst -u "${APP_USER}:${APP_GROUP}" $CMD
